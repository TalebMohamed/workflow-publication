<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>PublicationWorkflow</web>
<name>Script</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.Admin</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1357556398000</creationDate>
<date>1357729166000</date>
<contentUpdateDate>1357729166000</contentUpdateDate>
<version>1.1</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.1</syntaxId>
<hidden>true</hidden>
<content>{{velocity}}
#set($action = "$!request.action")
#set($workflowdoc = "$!request.workflowdoc")
#if($workflowdoc == "" || $action == "")
  {{info}}$msg.get('workflow.script.notenoughparams'){{/info}}
#else
  #set($workflowDocRef = $services.model.resolveDocument($workflowdoc))
  workflow doc ref: $workflowDocRef
  #if($action == "start")
    #set($targetReference = $services.model.createDocumentReference("", "$!request.space", "$!request.page"))
    #set($workflowConfig = "$request.workflow")
    #set($result = $services.publicationworkflow.startWorkflow($workflowDocRef, $workflowConfig, $targetReference))
  #elseif ($action == "submitformoderation")
    #set($result = $services.publicationworkflow.submitForModeration($workflowDocRef))
  #elseif ($action == "submitforvalidation")
    #set($result = $services.publicationworkflow.submitForValidation($workflowDocRef))
  #elseif ($action == "publish")
    #set($result = $services.publicationworkflow.publish($workflowDocRef))
  #end    
  
  #if ($result)
    $response.sendRedirect($xwiki.getURL($workflowDocRef, 'view', ''))
  #else
  #end
#end
{{/velocity}}</content></xwikidoc>
